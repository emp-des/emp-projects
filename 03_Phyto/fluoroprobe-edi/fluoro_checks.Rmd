Check fluoro data before uploading on EDI
3/28/23
Some annotations are general comments for Phoebe.

```{r}
# import packages
library(tidyverse)
library(deltamapr)
library(readxl)
library(sf)
library(sp)

# --Read in Data--
path <- '03_Phyto/fluoroprobe-edi/data/' # manually set path bc Rmd is weird with dirs

df_fl <-
    list.files(path = '03_Phyto/fluoroprobe-edi/data/',
               pattern = '*.csv') %>% # this part pulls all files in that directory that end in ".csv"
  map_df(~read_csv(paste0(path,.), show_col_types = FALSE)) # this merges them all together into one dataframe

# don't worry about the parsing errors; it imports as expected
```

Check: lat/lons make sense (don't worry about this Phoebe, though we can go over it if you want)
```{r}
# import delta sf
sf_delta <- R_EDSM_Subregions_Mahardja

# convert wq to spdf
coords <- df_fl[,c('Latitude','Longitude')]
data   <- subset(df_fl, select = -c(Latitude, Longitude))
crs    <- CRS('+init=epsg:4326 +proj=longlat')
spdf_wq <- SpatialPointsDataFrame(coords = coords,
                               data = data, 
                               proj4string = crs)

# convert delta to spdf
spdf_delta <- as(sf_delta, 'Spatial')
spdf_delta <- spTransform(spdf_delta, CRS('+init=epsg:4326 +proj=longlat'))

# add subregion to df
col_sr <- sp::over(spdf_wq, spdf_delta[,'SubRegion'])
spdf_wq$SubRegion <- col_sr$SubRegion

# convert to shapefile
sf_wq <- st_as_sf(spdf_wq)
sf_wq <- st_transform(sf_wq, st_crs = sf_delta)
sf_wq <- sf_wq %>% filter(!is.na(SubRegion))

# check data
ggplot() +
  geom_sf(data = sf_delta) +
  geom_sf(data = sf_wq, aes(color = SubRegion))
```

Data checks, modified from Phoebe's code.

Primarily checking for extreme outliers or changes in the dataset that point to a QC issue. Best done with timeseries.

Since data has large gaps, it's best to check on a day-by-day basis. 

(Can do this in a for loop/with functions, but won't for learning purposes. Can teach if wanted though.)

*GreenAlgae, Bluegreen, Diatoms, Cryptophyta*
```{r}
# to be slightly fancy, let's set the variables that change up here. that way we don't have to change every instance of them later
region = 'Confluence'
year = '2020'
month = 'August'

# add DateTime for graphing (eg. create x-axis)
df_fl$DateTime <- as.POSIXct(paste(df_fl$Date, df_fl$Time), format="%m/%d/%Y %H:%M:%S")

# factor month so it's in order
df_fl$Month <- factor(df_fl$Month, levels = month.name)

# best not to reuse names, so renamed these
Region_ug <- df_fl %>% 
  filter(Region == region, Year == year, Month == month) %>% # note that we set these to the objects we defined above 
  select(Month, DateTime, Date, GreenAlgae_2ug_L, Bluegreen_3ug_L, Diatoms_4ug_L, Cryptophyta_5ug_L) %>%
  pivot_longer(cols=c('GreenAlgae_2ug_L', 'Bluegreen_3ug_L', 'Diatoms_4ug_L', 'Cryptophyta_5ug_L'),
                                                 names_to='algae',
                                                 values_to='ug_L')

ggplot(Region_ug, aes(x=DateTime, y=ug_L)) + 
  geom_point(aes(color=algae)) +
  ggtitle(region) + # can use the object here too
  facet_wrap(. ~ Date, scales='free_x', ncol = 2) + # this will create a separate graph for each day with their own x-axes
  scale_color_manual(name='type', labels=c('green algae', 'bluegreen', 'diatoms', 'cryptophyta'),
                     values=c('green', 'steelblue', 'darkred', 'violet'))

Region_ml <- df_fl %>% 
  filter(Region == region, Year == year, Month == month) %>% 
  select(Month, DateTime, Date, GreenAlgae_14cells_mL, Bluegreen_15cells_mL, Diatoms_16cells_mL, Cryptophyta_17cells_mL) %>%
  pivot_longer(cols=c('GreenAlgae_14cells_mL', 'Bluegreen_15cells_mL', 'Diatoms_16cells_mL', 'Cryptophyta_17cells_mL'),
                                                 names_to='algae',
                                                 values_to='cells_mL')

ggplot(Region_ml, aes(x=DateTime, y=cells_mL)) + 
  geom_point(aes(color=algae)) +
  ggtitle(region) +
  facet_wrap(. ~ Date, scales='free_x', ncol = 2) + 
  scale_color_manual(name='type', labels=c('green algae', 'bluegreen', 'diatoms', 'cryptophyta'),
                     values=c('green', 'steelblue', 'darkred', 'violet'))
```

Create similar graphs for all other variables in dataset, including WQ (to check that they were integrated correctly)
```{r}

```

