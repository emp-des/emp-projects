Title: Nutrient Preservation Comparison Study
Contact: sarah.perry@water.ca.gov
Date: 01/2023

Summary: independent t-test to determine if there's a significant difference between acidified and frozen samples from Bryte

# Read in data
```{r message = FALSE}
# read in packages
library(tidyverse)
library(stats)
```

```{r message = FALSE}
# read in data
df_wq <- read_csv('01_WaterQuality/nutrient-comparison-study/data/nutrient_data.csv')

# mutate df
df_wq <- df_wq %>%
  pivot_longer(cols = c(Frozen, Acidified),
               names_to = 'PresType',
               values_to = 'Result') %>%
   drop_na()
```

# Descriptive analysis

Summary by preservation type
```{r}
by(data = df_wq, 
   INDICES = c(df_wq[,'Analyte'],df_wq[,'PresType']), 
   FUN = summary)
```
# Check boxplot
```{r}
ggplot(df_wq, aes(PresType, Result)) +
  geom_boxplot()+
   facet_wrap(~Analyte)
```
# Check variances are homogeneous
```{r}
for (analyte in unique(df_wq$Analyte)){
   df_test <- df_wq %>% subset(Analyte == analyte)
   barlett_test <- bartlett.test(df_test$Result ~ df_test$PresType)
   
   print(paste0('--',analyte,'--'))
   print(barlett_test)
}
```
Variances are homogeneous for all analytes.

# Check normality
```{r}
for (analyte in unique(df_wq$Analyte)){
   df_test <- df_wq %>% subset(df_wq$Analyte == analyte)
   
   qq_test <- qqnorm(df_test$Result[df_test$PresType == 'Frozen'], pch = 1, frame = FALSE)
   title(sub = analyte)
   
   print(qq_test)
}
```

```{r}
for (analyte in unique(df_wq$Analyte)){
   df_test <- df_wq %>% subset(df_wq$Analyte == analyte)
   
   qq_test <- qqnorm(df_test$Result[df_test$PresType == 'Acidified'], pch = 1, frame = FALSE)
   title(sub = analyte)
   
   print(qq_test)
}
```
For all, data is close enough to normal for a t-test. A bit debateable for NitrateNitrite and Orthophosphate, but I feel comfortable not applying any normalization transformations.

# t-test
```{r}
for (analyte in unique(df_wq$Analyte)){
   df_test <- df_wq %>% subset(Analyte == analyte)
   
   ttest <- t.test(formula = df_test$Result ~ df_test$PresType,
                   alternative = 'two.sided',
                   mu = 0, 
                   paired = FALSE,   
                   var.equal = TRUE,
                   conf.level = 0.95)
   
   print(paste0('--',analyte,'--'))
   print(ttest)
   }
```
p > 0.05 for all analytes.

Accept null hypothesis of no difference -- the two are the same -- for all analytes.
